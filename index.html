<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Links</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0f0c29;
            --card-bg: rgba(255, 255, 255, 0.08);
            --text-color: #ffffff;
            --accent: #00d2ff;
        }
        body {
            font-family: 'Kanit', sans-serif;
            margin: 0;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
        }

        /* Profile */
        .profile-section { text-align: center; margin-bottom: 20px; animation: fadeIn 0.8s ease; }
        .profile-img {
            width: 120px; height: 120px; border-radius: 50%;
            border: 3px solid var(--accent); padding: 4px; object-fit: cover;
            margin-bottom: 15px; box-shadow: 0 0 30px rgba(0, 210, 255, 0.3);
        }
        h1 { margin: 0; font-size: 1.8rem; font-weight: 600; }
        p.bio { opacity: 0.7; margin-top: 5px; font-weight: 300; font-size: 0.95rem; }

        /* Video Container (Youtube) */
        .video-container {
            width: 100%; max-width: 500px; margin-bottom: 25px;
            display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏•‡∏¥‡∏õ */
            animation: fadeIn 1s ease;
        }
        .video-wrapper {
            position: relative; padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0; overflow: hidden; border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            background: #000;
        }
        .video-wrapper iframe {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        }

        /* Links Container */
        .container { width: 100%; max-width: 500px; padding-bottom: 60px; display: flex; flex-direction: column; gap: 14px; }
        
        .link-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            padding: 16px 20px;
            border-radius: 16px;
            text-decoration: none;
            color: white;
            display: flex; align-items: center;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.25s ease;
            position: relative; overflow: hidden;
        }
        .link-card:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255,255,255,0.5);
        }

        /* Link Styles */
        .link-card.special-access {
            background: rgba(0, 210, 255, 0.15);
            border-color: var(--accent);
            box-shadow: 0 0 15px rgba(0, 210, 255, 0.2);
        }
        .group-divider {
            display: flex; align-items: center; color: var(--accent);
            font-size: 0.9rem; margin: 10px 0 5px 0; font-weight: 500;
        }
        .group-divider::before, .group-divider::after {
            content: ''; flex: 1; height: 1px; background: rgba(255,255,255,0.2);
        }
        .group-divider span { padding: 0 10px; }

        /* Icons */
        .link-icon { font-size: 1.6rem; margin-right: 18px; width: 35px; text-align: center; }
        .fa-facebook { color: #1877F2; } .fa-youtube { color: #FF0000; } .fa-instagram { color: #E4405F; }
        .fa-line { color: #00C300; } .fa-tiktok { color: #ff0050; filter: drop-shadow(2px 2px 0px #00f2ea); }
        .fa-google-drive { color: #1FA463; } .fa-github { color: #ffffff; } .fa-envelope { color: #FFC107; }
        .fa-link { color: var(--accent); }
        .link-text { font-size: 1.05rem; font-weight: 500; }
        .badge { margin-left: auto; font-size: 0.75rem; padding: 4px 10px; border-radius: 20px; font-weight: 600; text-transform: uppercase; }
        .badge-vip { background: linear-gradient(45deg, #FFD700, #FFA500); color: #000; }

        /* Unlock Btn */
        .unlock-btn {
            position: fixed; bottom: 20px; right: 20px;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px);
            color: #aaa; border: 1px solid rgba(255,255,255,0.1);
            border-radius: 50%; width: 45px; height: 45px;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; transition: 0.3s; z-index: 100;
        }
        .unlock-btn.active { color: #00d2ff; border-color: #00d2ff; background: rgba(0, 210, 255, 0.1); }
        .admin-link { margin-top: auto; color: rgba(255,255,255,0.2); text-decoration: none; font-size: 0.8rem; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="profile-section" id="profile-section"></div>

    <div class="video-container" id="featured-video">
        <div class="video-wrapper">
            <iframe id="youtube-iframe" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
    </div>

    <div class="container" id="links-container">
        <div style="text-align: center; opacity: 0.5;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
    </div>

    <a href="admin.html" class="admin-link"><i class="fas fa-cog"></i> Manage</a>

    <button class="unlock-btn" id="unlockBtn" onclick="handleUnlock()">
        <i class="fas fa-lock"></i>
    </button>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        // ‚ö†Ô∏è ‡πÉ‡∏™‡πà Config ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        const firebaseConfig = {
            apiKey: "AIzaSyB-Brx6cQ7dFhQqbEhDG4xIT4jcVG1yogs",
  authDomain: "mylinks-web.firebaseapp.com",
  projectId: "mylinks-web",
  storageBucket: "mylinks-web.firebasestorage.app",
  messagingSenderId: "702413304222",
  appId: "1:702413304222:web:d255e6c2f428bb1e1d668f",
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let currentAccessGroup = 'public';
        let accessRules = {};

        function loadData() {
            db.doc("settings/profile").get().then((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    renderProfile(data);
                    renderVideo(data.featuredVideo); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠

                    if (data.accessConfig) {
                        data.accessConfig.split('\n').forEach(line => {
                            const [code, group] = line.split(':');
                            if(code && group) accessRules[code.trim()] = group.trim();
                        });
                    }
                }
            });

            db.collection("links").orderBy("order", "asc").get().then((snapshot) => {
                const container = document.getElementById('links-container');
                container.innerHTML = ''; 

                if(snapshot.empty) {
                    container.innerHTML = '<p style="text-align:center; opacity:0.5;">Empty</p>';
                    return;
                }

                let allLinks = [];
                snapshot.forEach(doc => allLinks.push(doc.data()));

                const visibleLinks = allLinks.filter(link => {
                    const linkGroup = link.group || 'public';
                    return linkGroup === 'public' || linkGroup === currentAccessGroup;
                });

                const specialLinks = visibleLinks.filter(link => link.group === currentAccessGroup && currentAccessGroup !== 'public');
                const publicLinks = visibleLinks.filter(link => !link.group || link.group === 'public');

                if (specialLinks.length > 0) {
                    container.innerHTML += `<div class="group-divider"><span>üîì ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏©: ${currentAccessGroup.toUpperCase()}</span></div>`;
                    specialLinks.forEach(link => renderLink(container, link, true));
                }
                if (publicLinks.length > 0) {
                    if (specialLinks.length > 0) container.innerHTML += `<div class="group-divider"><span>üåç ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞</span></div>`;
                    publicLinks.forEach(link => renderLink(container, link, false));
                }
            });
        }

        function renderProfile(data) {
            document.getElementById('profile-section').innerHTML = `
                <img src="${data.imageUrl || 'https://ui-avatars.com/api/?name=User'}" class="profile-img">
                <h1>${data.name || 'My Links'}</h1>
                <p class="bio">${data.bio || ''}</p>
            `;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
        function renderVideo(url) {
            const videoContainer = document.getElementById('featured-video');
            const iframe = document.getElementById('youtube-iframe');
            
            if (url) {
                const videoId = extractVideoID(url);
                if (videoId) {
                    iframe.src = `https://www.youtube.com/embed/${videoId}`;
                    videoContainer.style.display = 'block';
                } else {
                    videoContainer.style.display = 'none';
                }
            } else {
                videoContainer.style.display = 'none';
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏∂‡∏á ID ‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå Youtube
        function extractVideoID(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        function renderLink(container, link, isSpecial) {
            const iconClass = link.icon || 'fas fa-link';
            const specialClass = isSpecial ? 'special-access' : '';
            const badge = isSpecial ? `<span class="badge badge-vip">${link.group}</span>` : '';

            const html = `
                <a href="${link.url}" target="_blank" class="link-card ${specialClass}">
                    <div class="link-icon"><i class="${iconClass}"></i></div>
                    <div class="link-text">${link.title}</div>
                    ${badge}
                </a>
            `;
            container.innerHTML += html;
        }

        function handleUnlock() {
            if (currentAccessGroup !== 'public') {
                currentAccessGroup = 'public';
                alert("üîí ‡∏•‡πá‡∏≠‡∏Ñ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß");
                document.getElementById('unlockBtn').classList.remove('active');
                document.getElementById('unlockBtn').innerHTML = '<i class="fas fa-lock"></i>';
                loadData();
            } else {
                const input = prompt("üîë ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á:");
                if (input && accessRules[input]) {
                    currentAccessGroup = accessRules[input];
                    document.getElementById('unlockBtn').classList.add('active');
                    document.getElementById('unlockBtn').innerHTML = '<i class="fas fa-unlock"></i>';
                    loadData();
                } else if (input) {
                    alert("‚ùå ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
                }
            }
        }

        loadData();
    </script>
</body>
</html>
